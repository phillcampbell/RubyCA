%h2 Certificate Signing Requests

%nav
  #nav-tab.nav.nav-tabs{:role => 'tablist'}
    %button#nav-sign-csr-tab.nav-link{:class => ('active' if @csrs.any? && @csr.nil?), 'aria-controls' => 'nav-sign-csr', 'aria-selected' => 'true', 'data-target' => '#nav-sign-csr', 'data-toggle' => 'tab', :role => 'tab', :type => 'button'} Sign CSR
    %button#nav-create-csr-tab.nav-link{:class => ('active' unless @csrs.any? && @csr.nil?), 'aria-controls' => 'nav-create-csr', 'aria-selected' => 'false', 'data-target' => '#nav-create-csr', 'data-toggle' => 'tab', :role => 'tab', :type => 'button'} Create CSR
    %button#nav-schema-tab.nav-link{'aria-controls' => 'nav-schema', 'aria-selected' => 'false', 'data-target' => '#nav-schema', 'data-toggle' => 'tab', :role => 'tab', :type => 'button'} Load Schema
    
  #nav-tabContent.tab-content
    #nav-sign-csr.tab-pane.fade{:class => ('active show' if @csrs.any? && @csr.nil?),'aria-labelledby' => 'nav-sign-csr-tab', :role => 'tabpanel'}
      %legend Awaiting Signature
      %table.table.table-striped.table-hover.table-sm
        %thead
          %tr
            %th Common Name
            %th Organization
            %th
        %tbody
          - if @csrs.any?
            - @csrs.each do |csr|
              %tr
                %td
                  = csr.cn
                %td 
                  = csr.o

                %td.float-right
                  %form{ :action => "/admin/csrs/#{csr.cn}", :method => 'POST', :onsubmit => "return confirm('Are you sure you want to delete this request?')"  }
                    .btn-group{role: 'group' }
                      %a.btn.btn-sm.btn-info{ href: "/admin/csrs/#{csr.cn}/info" , 'data-get' => 'modal',  'data-title' => 'CSR Info' }
                        %i.fas.fa-info-circle
                        %span.d-none.d-md-inline Info
                      %a.btn.btn-primary.btn-sm{ href: "/admin/csrs/#{csr.cn}/sign" }
                        %i.fas.fa-pen
                        %span.d-none.d-md-inline Sign
                      %input{ type: 'hidden', name: '_method', value: 'DELETE'} 
                      %button.btn.btn-danger.btn-sm{ :type => 'submit' }
                        %i.fas.fa-trash
                        %span.d-none.d-md-inline Delete
          -else
            %tr
              %td{ colspan: 3}
                No CSR to sign yet!
                
    #nav-create-csr.tab-pane.fade{:class => ('active show' unless @csrs.any? && @csr.nil?),'aria-labelledby' => 'nav-create-csr-tab', :role => 'tabpanel'}      
      %form#csr.form-horizontal{ action: '/admin/csrs', method: 'post' }
        %fieldset.form-group
          %legend Create CSR
          .col-xs-12.col-md-6
            .form-group
              %label{ for: 'cn' } Common Name
              %input.form-control#cn{ name: 'csr[cn]', type: 'text', placeholder: 'e.g. www.acme.com', value: @csr.nil? ? '' : @csr[:cn] }
            .form-group
              %label{ for: 'o' } Organisation
              %input.form-control#o{ name: 'csr[o]', type: 'text', placeholder: 'e.g. ACME Ltd', value: @csr.nil? ? '' : @csr[:o] }
            .form-group
              %label{ for: 'l' } Locality
              %input.form-control#l{ name: 'csr[l]', type: 'text', placeholder: 'e.g. Birmingham', value: @csr.nil? ? '' : @csr[:l] }
            .form-group
              %label{ for: 'st' } State
              %input.form-control#st{ name: 'csr[st]', type: 'text', placeholder: 'e.g. West Midlands', value: @csr.nil? ? '' : @csr[:st] }
            .form-group
              %label{ for: 'c' } Country Code
              %input.form-control#c{ name: 'csr[c]', type: 'text', placeholder: 'e.g. GB', value: @csr.nil? ? '' : @csr[:c] }
            .form-group
              %label{ for: 'passphrase' } Key Passphrase
              %input.form-control#passphrase{ name: 'csr[passphrase]', type: 'password', autocomplete: 'off', placeholder: '' }
            .form-group
              %label{ for: 'passphrase-confirm' } Confirm Passphrase
              %input.form-control#passphrase-confirm{ name: 'csr[confirm]', type: 'password', autocomplete: 'off', placeholder: '' }

          .form-group
            %button.btn.btn-primary{ type: 'submit' } Create New
            - if !@csr.nil?
              %a.btn.btn.btn-secondary{ href: '/admin/csrs/cancel' } Cancel

    #nav-schema.tab-pane.fade{'aria-labelledby' => 'nav-schema-tab', :role => 'tabpanel'}
      %legend Certificate Schemas
      %table.table.table-striped.table-hover.table-sm
        %thead
          %tr
            %th
            %th Organization
            %th Location
            %th State
            %th Country
        %tbody
          - if  @cschemas.any?
            - @cschemas.each do |cschema|
              %tr
                %td
                  %a.btn.btn-primary.btn-sm{ href: "/admin/cschema/#{cschema.id}" }
                    %i.fas.fa-arrow-circle-down
                    %span.d-none.d-md-inline Load
                %td 
                  =cschema.o
                %td 
                  = cschema.l
                %td
                  = cschema.st
                %td 
                  = cschema.c
          - else
            %tr
              %td{colspan: 3}
                No Schema added yet!
                
      %a.btn.btn.btn-primary.float-right{ href: '/admin/cschemas' } Manage Schemas